var jform=harlan.store.get("neoassist")[0];jform.find("input[name='email']").attr("type","email"),jform.find("input[name='documento']").mask("999.999.999-99"),harlan.store.set("neoassist::consulta",!0);var arrayUnique=function(a){a=a.sort(function(a,e){return 1*a-1*e});for(var e=[a[0]],t=1;t<a.length;t++)a[t-1]!==a[t]&&e.push(a[t]);return e},parsePhoto=function(a,e){var t=[];e.find("BPQL > body photos > url").each(function(a,e){t.push($(e).text())}),e.find("*[profileImage]").each(function(a){t.push($(a).attr("profileImage"))}),t.length&&a.addItem().addClass("photo").css("background-image","url("+t[0]+")")},socialNetwork=function(a,e){var t=e.find("BPQL > body socialProfiles > socialProfiles");t.length&&(a.addSeparator("Redes Sociais","Perfis na Internet","Referência de perfis sociais"),t.each(function(e,t){var n=$(t),r=a.addItem("Perfil",n.find("typeName").text());r.prepend($("<a />").attr({target:"_blank",href:n.find("url").text(),title:"typeName"}).append(r.find(".value")))}))},setContact=function(a,e){var t=[],n=[];if(e.find("BPQL > body > phones > phone:lt(3)").each(function(a,e){var n=$(e);t.push("("+n.find("area-code").text()+") "+n.find("number").text())}),e.find("BPQL > body email:lt(3)").each(function(a,e){n.push($(e).text())}),t.length||n.length){t=arrayUnique(t),n=arrayUnique(n),a.addSeparator("Contato","Meios de contato","Telefone, e-mail e outros");for(var r in t)a.addItem("Telefone",t[r]);for(var i in n)a.addItem("Email",n[i])}},addMap=function(a,e){var t=[];a.block(),e.find("BPQL > body > addresses address").first().find("*").each(function(a,e){var n=$(e);/(address|number|address-complement|bairro)/.test(n.prop("tagName"))||t.push(n.text())});var n=window.innerWidth-90,r="http://maps.googleapis.com/maps/api/staticmap?"+$.param({scale:"1",size:(120>n?120:n).toString()+"x150",maptype:"roadmap",format:"png",visual_refresh:"true",markers:"size:mid|color:red|label:1|"+t.join(", ")});a.addItem("Localização Aproximada","").addClass("map").find(".value").append($("<a />").attr({href:"https://www.google.com/maps?"+$.param({q:t.join(", ")}),target:"_blank"}).append($("<img />").attr("src",r)))};harlan.importXMLDocument.register("NEOASSIST","CONSULTA",function(a){var e=harlan.call("resultGenerator"),t=$(a),n=function(a,e,t){t=t||{60:"attention",80:"warning"};var n=null;for(var r in t){if(console.log([e<parseInt(r),e,parseInt(r)]),e<parseInt(r))break;n=t[r]}return n&&a.addClass(n),a},r=function(a,t,r){if(!(0>=t)){var i=e.addItem(a,"").addClass("center"),o=i.find(".value"),d=harlan.interface.widgets.radialProject(o,t);return n(d,t,r)}};parsePhoto(e,t);var i=null,o=t.find("BPQL > body bio").first();return o.length&&(i=o.text()),e.addItem(i||"Nome",t.find("BPQL > body > name, BPQL > body> fullName").first().text()),e.addItem("Idade Aproximada",t.find("approximate-age").first().text()).addClass("center"),e.addItem("Critério",t.find("criteria").first().text()).addClass("center"),e.addItem("Média E-commerce","R$"+t.find("BPQL > body > buy-avg").text()),e.addItem("Máximo E-commerce","R$"+t.find("BPQL > body > buy-limit").text()),e.block(),r("Risco Social",parseInt(t.find("BPQL > body > social-risk").text())),r("Influência",parseInt(t.find("BPQL > body > influence").text())),r("Risco Jurídico",parseInt(t.find("BPQL > body > juridic-risk").text())),r("Confiança",parseInt(t.find("BPQL > body > confidence").text()),{0:"warning",50:"attention",70:null}),addMap(e,t),setContact(e,t),socialNetwork(e,t),e.generate()}),neoassist();